var Utilities,ProjectTracking;(function(n){var t=function(){function t(n,t,i){i===void 0&&(i=!1);this.Label=n;this.Value=t;this.selected=i}return t.GetDepartments=function(){n.departments=[];var i=n.GetPath();Utilities.Get(i+"API/Project/Departments/All").then(function(i){var r,u,f;for(console.log("all departments",i),n.departments.push(new t("All Departments","")),n.departments.push(new t("My Departments Only","mine",!0)),r=0,u=i;r<u.length;r++)f=u[r],n.departments.push(f);t.BuildDataValueSelect("departmentFilter",n.departments)},function(n){console.log("error getting permits",n)})},t.GetMyDepartments=function(){n.my_departments=[];var i=n.GetPath();Utilities.Get(i+"API/Project/Departments/My").then(function(i){console.log("my departments",i);n.my_departments=i;t.BuildDataValueSelect("projectDepartment",i)},function(n){console.log("error getting permits",n)})},t.BuildDataValueSelect=function(n,t){var e=document.getElementById(n),r,f,u,i;for(Utilities.Clear_Element(e),r=0,f=t;r<f.length;r++)u=f[r],i=document.createElement("option"),i.value=u.Value,i.selected=u.selected,i.appendChild(document.createTextNode(u.Label)),e.add(i,null)},t.GetFunding=function(){n.funding_sources=[];var i=n.GetPath();Utilities.Get(i+"API/Project/Funding").then(function(i){var r,u,f;for(console.log("all funding",i),r=0,u=i;r<u.length;r++)f=u[r],n.funding_sources.push(f);t.BuildDataValueSelect("projectFunding",n.funding_sources)},function(n){console.log("error getting funding",n)})},t}();n.DataValue=t})(ProjectTracking||(ProjectTracking={})),function(n){function t(n){typeof n=="string"&&(n=document.getElementById(n));n.classList.add("hide");n.classList.remove("show");n.classList.remove("show-inline");n.classList.remove("show-flex")}function i(n){typeof n=="string"&&(n=document.getElementById(n));n.classList.add("show");n.classList.remove("hide");n.classList.remove("show-inline");n.classList.remove("show-flex")}function l(n){typeof n=="string"&&(n=document.getElementById(n));n.classList.add("show-inline");n.classList.remove("hide");n.classList.remove("show");n.classList.remove("show-flex")}function a(n){typeof n=="string"&&(n=document.getElementById(n));n.classList.add("show-flex");n.classList.remove("hide");n.classList.remove("show-inline");n.classList.remove("show")}function e(n,u,f){var e,o,s;typeof n=="string"&&(n=document.getElementById(n));u&&(r(n),e=document.createElement("div"),e.classList.add("notification"),e.classList.add("is-danger"),o=document.createElement("button"),o.classList.add("delete"),o.onclick=function(){t(n)},e.appendChild(o),Array.isArray(u)?(s=document.createElement("ul"),u.forEach(function(n){var t=document.createElement("li");t.appendChild(document.createTextNode(n));s.appendChild(t)}),e.appendChild(s)):e.appendChild(document.createTextNode(u)),n.appendChild(e));i(n);(f==undefined||f===!0)&&window.setTimeout(function(){t(n)},1e4)}function r(n){if(n!==null&&n!==undefined)while(n.firstChild)n.removeChild(n.firstChild)}function v(n,t,i){i===void 0&&(i=!1);var r=document.createElement("option");return r.value=n,r.text=t,r.selected=i,r}function o(n){return typeof n=="string"&&(n=document.getElementById(n)),n.value}function y(n,t){typeof n=="string"&&(n=document.getElementById(n));n.value=t}function u(n,t){typeof n=="string"&&(n=document.getElementById(n));r(n);n.appendChild(document.createTextNode(t))}function s(n){var u=n.replace("nav-",""),r=document.querySelectorAll("#menuTabs > li > a"),t,i;if(r.length>0)for(t=0;t<r.length;t++)i=r.item(t),i.id===n?i.parentElement.classList.add("is-active"):i.parentElement.classList.remove("is-active");f("#views > section",u)}function p(n,t,i){h(n,"nav-"+i);f(t,i)}function h(n,t){var u=document.querySelectorAll(n),i,r;if(u.length>0)for(i=0;i<u.length;i++)r=u.item(i),r.id===t?r.classList.add("is-active"):r.classList.remove("is-active")}function f(n,r){var e=document.querySelectorAll(n),u,f;if(e.length>0)for(u=0;u<e.length;u++)f=e.item(u),f.id===r?i(f):t(f)}function w(n){return fetch(n,{method:"GET",headers:{"Content-Type":"application/json"},cache:"no-cache",credentials:"include"}).then(function(n){if(console.log("get response",n),!n.ok)throw new Error(n.statusText);return n.json()})}function b(n,t){return fetch(n,{method:"POST",body:JSON.stringify(t),cache:"no-cache",headers:{"Content-Type":"application/json"},credentials:"include"}).then(function(n){if(console.log("Post Response",n),!n.ok)throw new Error(n.statusText);return n.json()})}function k(n,t){return fetch(n,{method:"POST",body:t!==null?JSON.stringify(t):"",cache:"no-cache",headers:{"Content-Type":"application/json"},credentials:"include"}).then(function(n){return n})}function d(n){return n.toLocaleString("en-US",{style:"currency",currency:"USD"})}function g(n){return n instanceof Date?n.toLocaleDateString("en-us"):new Date(n).toLocaleDateString("en-US")}function nt(n,t,i){var r,u;return(typeof n=="string"&&(n=document.getElementById(n)),r=n,r.tagName.toLowerCase()==="select"?r.parentElement.classList.remove("is-danger"):r.classList.remove("is-danger"),u=o(r).trim(),u.length==0)?(r.tagName.toLowerCase()==="select"?r.parentElement.classList.add("is-danger"):r.classList.add("is-danger"),e(t,i),r.focus(),r.scrollTo(),""):u}function tt(n,t){typeof n=="string"&&(n=document.getElementById(n));var i=n;i.disabled=t;i.classList.toggle("is-loading",t)}function it(n){var u=document.createElement("li"),t,i,f,o,r,e,s;if(n.selected&&u.classList.add("is-active"),t=document.createElement("a"),t.id=n.id,t.onclick=function(){c(n)},n.icon.length>0){for(i=document.createElement("span"),i.classList.add("icon"),i.classList.add("is-medium"),f=document.createElement("i"),o=n.icon.split(" "),r=0,e=o;r<e.length;r++)s=e[r],f.classList.add(s);i.appendChild(f);t.appendChild(i)}return t.appendChild(document.createTextNode(n.label)),u.appendChild(t),u}function c(n){u("menuTitle",n.title);u("menuSubTitle",n.subTitle);s(n.id);document.getElementById(n.autofocusId).focus()}function rt(t,i){for(var f,e=document.getElementById(t),r=0,u=i;r<u.length;r++)f=u[r],e.appendChild(n.Create_Menu_Element(f))}function ut(){return(navigator.userAgent.indexOf("Opera")||navigator.userAgent.indexOf("OPR"))!=-1?"Opera":navigator.userAgent.indexOf("Chrome")!=-1?"Chrome":navigator.userAgent.indexOf("Safari")!=-1?"Safari":navigator.userAgent.indexOf("Firefox")!=-1?"Firefox":navigator.userAgent.indexOf("MSIE")!=-1||!!document.DOCUMENT_NODE==!0?"IE":"unknown"}n.Hide=t;n.Show=i;n.Show_Inline=l;n.Show_Flex=a;n.Error_Show=e;n.Clear_Element=r;n.Create_Option=v;n.Get_Value=o;n.Set_Value=y;n.Set_Text=u;n.Show_Menu=s;n.Handle_Tabs=p;n.Activate_Inactivate_Selector=h;n.Show_Hide_Selector=f;n.Get=w;n.Post=b;n.Post_Empty=k;n.Format_Amount=d;n.Format_Date=g;n.Validate_Text=nt;n.Toggle_Loading_Button=tt;n.Create_Menu_Element=it;n.Update_Menu=c;n.Build_Menu_Elements=rt;n.CheckBrowser=ut}(Utilities||(Utilities={})),function(n){"use strict";var t=function(){function t(){this.id=-1;this.project_id=-1;this.comment="";this.update_only=!1;this.added_by="";this.added_on=new Date;this.by_county_manager=!1}return t.UpdateOnly=function(){var t="updateProjectAsUpToDate",i;(Utilities.Toggle_Loading_Button(t,!0),console.log("current project",n.selected_project),n.selected_project.id!==-1)&&(i=n.GetPath(),Utilities.Post_Empty(i+"API/Project/AddUpdateComment?project_id="+n.selected_project.id.toString(),null).then(function(i){console.log("post response",i);i.ok?(n.Project.GetProjects(),n.CloseModals()):(console.log("some errors happened with post response"),alert("There was an issue saving this update.  Please try again, and put in a help desk ticket if the issue persists."));Utilities.Toggle_Loading_Button(t,!1)},function(n){console.log("error getting permits",n);Utilities.Toggle_Loading_Button(t,!1)}))},t.CommentsView=function(n,t){var i,r,u,o;if(n.sort(function(n,t){return n.id-t.id}),i=document.createDocumentFragment(),n.length===0)return i;for(r=document.createElement("ol"),r.style.marginLeft="1em",u=0,o=n;u<o.length;u++){var f=o[u],s=document.createElement("li"),h=t?f.added_by+" - "+f.comment:f.comment,e=document.createElement("span");e.appendChild(document.createTextNode(h));f.by_county_manager&&(e.style.color="red",e.style.fontWeight="bold");s.appendChild(e);r.appendChild(s)}return i.appendChild(r),i},t.PopulateCommentsFieldset=function(n){var r=document.getElementById("existingCommentsContainer"),i=document.createElement("legend");i.classList.add("label");i.appendChild(document.createTextNode("Comments"));r.appendChild(i);r.appendChild(t.CommentsView(n,!0))},t}();n.Comment=t}(ProjectTracking||(ProjectTracking={})),function(n){"use strict";var t=function(){function t(){this.id=-1;this.project_id=-1;this.name="";this.display_order=-1}return t.AddMilestone=function(){var h,k,w,c,o,d,e,l,i,a,v,g,r,y,p,b,f;n.number_of_milestones++;var u=n.number_of_milestones.toString(),tt=t.GetContainer(),nt=document.createDocumentFragment(),s=document.createElement("tr");s.id="milestone"+u;h=document.createElement("td");h.style.textAlign="center";h.style.verticalAlign="middle";h.appendChild(document.createTextNode(u));s.appendChild(h);k=document.createElement("td");w=document.createElement("div");w.classList.add("field");c=document.createElement("div");c.classList.add("control");c.classList.add("is-medium");o=document.createElement("input");o.classList.add("input");o.classList.add("is-medium");o.type="text";o.id="projectMilestone"+u;c.appendChild(o);w.appendChild(c);k.appendChild(w);s.appendChild(k);d=document.createElement("td");e=document.createElement("div");e.classList.add("field");e.classList.add("is-grouped");l=document.createElement("div");l.classList.add("control");i=document.createElement("button");i.id="milestoneUp"+u;i.type="button";i.style.borderRadius="99px";i.setAttribute("aria-label","Move Milestone Up");i.classList.add("button");i.classList.add("is-medium");i.disabled=n.number_of_milestones===1;i.onclick=function(){t.MoveUp(u)};a=document.createElement("span");a.classList.add("icon");a.classList.add("is-large");v=document.createElement("i");v.classList.add("fas");v.classList.add("fa-arrow-circle-up");v.classList.add("fa-2x");a.appendChild(v);i.appendChild(a);l.appendChild(i);g=document.createElement("div");g.classList.add("control");r=document.createElement("button");r.id="milestoneDown"+u;r.type="button";r.style.borderRadius="99px";r.setAttribute("aria-label","Move Milestone Down");r.classList.add("button");r.classList.add("is-medium");r.disabled=!0;r.onclick=function(){t.MoveDown(u)};y=document.createElement("span");y.classList.add("icon");y.classList.add("is-large");p=document.createElement("i");p.classList.add("fas");p.classList.add("fa-arrow-circle-down");p.classList.add("fa-2x");y.appendChild(p);r.appendChild(y);l.appendChild(r);b=document.createElement("div");b.classList.add("control");f=document.createElement("button");f.id="milestoneRemove"+u;f.classList.add("is-warning");f.classList.add("button");f.classList.add("is-medium");f.disabled=n.number_of_milestones===1;f.appendChild(document.createTextNode("Remove"));f.onclick=function(){t.Remove(u)};b.appendChild(f);e.appendChild(l);e.appendChild(g);e.appendChild(b);d.appendChild(e);s.appendChild(d);nt.appendChild(s);tt.appendChild(nt);t.UpdateMilestoneButtons()},t.MoveUp=function(n){var t=parseInt(n);if(t>1){var i="projectMilestone"+n,r="projectMilestone"+(t-1).toString(),u=Utilities.Get_Value(i),f=Utilities.Get_Value(r);Utilities.Set_Value(i,f);Utilities.Set_Value(r,u)}},t.MoveDown=function(t){var i=parseInt(t);if(i<n.number_of_milestones){var r="projectMilestone"+t,u="projectMilestone"+(i+1).toString(),f=Utilities.Get_Value(r),e=Utilities.Get_Value(u);Utilities.Set_Value(r,e);Utilities.Set_Value(u,f)}},t.Remove=function(i){var f=parseInt(i),r,u;if(f<n.number_of_milestones)for(r=f;r<=n.number_of_milestones;r++)t.MoveDown(r.toString());u=document.getElementById("milestone"+n.number_of_milestones.toString());u.parentNode.removeChild(u);n.number_of_milestones--;t.UpdateMilestoneButtons()},t.UpdateMilestoneButtons=function(){for(var i,r,t=1;t<=n.number_of_milestones;t++)i=document.getElementById("milestoneDown"+t.toString()),i.disabled=t===n.number_of_milestones,r=document.getElementById("milestoneRemove"+t.toString()),r.disabled=n.number_of_milestones===1},t.GetContainer=function(){return document.getElementById("projectMilestones")},t.ClearMilestones=function(){n.number_of_milestones=0;Utilities.Clear_Element(t.GetContainer())},t.LoadMilestones=function(n){var i,u,r,e,f;for(t.ClearMilestones(),i=0,u=n;i<u.length;i++)f=u[i],t.AddMilestone();for(r=0,e=n;r<e.length;r++)f=e[r],t.UpdateMilestone(f);t.UpdateMilestoneButtons()},t.UpdateMilestone=function(n){Utilities.Set_Value("projectMilestone"+n.display_order.toString(),n.name)},t.MilestonesView=function(n){var t,i,r,u,e,f;if(n.sort(function(n,t){return n.display_order-t.display_order}),t=document.createDocumentFragment(),n.length===0)return t;for(i=document.createElement("ol"),i.classList.add("comments"),r=0,u=n;r<u.length;r++)e=u[r],f=document.createElement("li"),f.appendChild(document.createTextNode(e.name)),i.appendChild(f);return t.appendChild(i),t},t.ReadMilestones=function(){for(var u,r,f=[],i=50;i>0;i--)u=document.getElementById("projectMilestone"+i.toString()),u!==null&&Utilities.Get_Value(u).trim().length===0&&t.Remove(i.toString());for(i=1;i<=n.number_of_milestones;i++)r=new t,r.display_order=i,r.name=Utilities.Get_Value("projectMilestone"+i.toString()).trim(),f.push(r);return f},t}();n.Milestone=t}(ProjectTracking||(ProjectTracking={})),function(n){"use strict";var t=function(){function t(){this.id=-1;this.project_name="";this.department_id=-1;this.funding_id=1;this.timeline="";this.commissioner_share=!1;this.infrastructure_share=!1;this.completed=!1;this.date_last_updated=null;this.date_completed=null;this.can_edit=!1;this.milestones=[];this.comments=[]}return t.GetProjects=function(){var i="filterRefreshButton",r;Utilities.Toggle_Loading_Button(i,!0);r=n.GetPath();Utilities.Get(r+"API/Project/List").then(function(r){console.log("projects",r);n.projects=r;t.BuildProjectTrackingList(t.ApplyFilters(r));n.FinishedLoading();r.length===0&&n.AddProjectResultsMessage("No projects were found. You can use the Add Project button to add a new project.");Utilities.Toggle_Loading_Button(i,!1)},function(t){t.message.trim().toLowerCase()==="unauthorized"?n.AddProjectResultsMessage("You do not currently have access to the Project Tracking application."):t&&(n.AddProjectResultsMessage("There was a problem retrieving a list of projects.  Please try again. If this issue persists, please put in a help desk ticket."),console.log("error getting permits",t));Utilities.Toggle_Loading_Button(i,!1)})},t.ApplyFilters=function(n){var i=Utilities.Get_Value("departmentFilter"),t=document.getElementById("projectCommissionerShareFilter").checked,r=document.getElementById("projectCompleteFilter").checked,u=document.getElementById("projectInfrastructureFilter").checked;return n=n.filter(function(n){return i.length===0||n.department_id.toString()===i||i==="mine"&&n.can_edit}),n=n.filter(function(n){return t&&n.commissioner_share||!t}),n=n.filter(function(n){return t&&n.commissioner_share||!t}),n=n.filter(function(n){return r&&!n.completed||!r}),n.filter(function(n){return u&&n.infrastructure_share||!u})},t.AddProject=function(){Utilities.Hide("updateProjectAsUpToDate");n.selected_project=new t;t.UpdateProjectName("");t.UpdateProjectDepartment("");t.UpdateProjectFunding("0");n.Milestone.ClearMilestones();t.UpdateProjectTimeline("");t.UpdateProjectCompleted(!1);t.UpdateCommissionerShare(!1);t.UpdateInfrastructureShare(!1);var i=document.getElementById("existingCommentsContainer");Utilities.Hide(i);Utilities.Clear_Element(i);t.ClearComment();n.ShowAddProject()},t.LoadProject=function(i){Utilities.Show("updateProjectAsUpToDate");i.comments=i.comments.filter(function(n){return n.comment.length>0});t.UpdateProjectName(i.project_name);t.UpdateProjectDepartment(i.department_id.toString());t.UpdateProjectFunding(i.funding_id.toString());n.Milestone.LoadMilestones(i.milestones);t.UpdateProjectTimeline(i.timeline);t.UpdateProjectCompleted(i.completed);t.UpdateCommissionerShare(i.commissioner_share);t.UpdateInfrastructureShare(i.infrastructure_share);var r=document.getElementById("existingCommentsContainer");Utilities.Clear_Element(r);i.comments.length>0?(Utilities.Show(r),n.Comment.PopulateCommentsFieldset(i.comments)):Utilities.Hide(r);t.ClearComment();n.ShowAddProject()},t.UpdateProjectName=function(n){Utilities.Set_Value("projectName",n)},t.UpdateProjectDepartment=function(n){Utilities.Set_Value("projectDepartment",n)},t.UpdateProjectFunding=function(n){Utilities.Set_Value("projectFunding",n)},t.UpdateProjectTimeline=function(n){Utilities.Set_Value("projectTimeline",n)},t.UpdateProjectCompleted=function(n){var t=document.getElementById("projectComplete");t.checked=n},t.UpdateInfrastructureShare=function(n){var t=document.getElementById("projectInfrastructureShare");t.checked=n},t.UpdateCommissionerShare=function(n){var t=document.getElementById("projectCommissionerShare");t.checked=n},t.ClearComment=function(){Utilities.Set_Value("projectComment","")},t.BuildProjectTrackingList=function(n){var f=document.getElementById("projectList"),r,i,u,e;for(Utilities.Clear_Element(f),r=document.createDocumentFragment(),i=0,u=n;i<u.length;i++)e=u[i],r.appendChild(t.CreateProjectRow(e));f.appendChild(r)},t.CreateProjectRow=function(i){var r,u,o,s,h;i.comments=i.comments.filter(function(n){return n.comment.length>0});r=document.createElement("tr");r.classList.add("pagebreak");var f=document.createElement("td"),c=document.createElement("td"),v=n.Comment.CommentsView(i.comments,!1);i.can_edit?(u=document.createElement("a"),u.appendChild(document.createTextNode(i.project_name)),u.onclick=function(){n.selected_project=i;t.LoadProject(i);console.log("selected_project",n.selected_project)},f.appendChild(u)):f.appendChild(document.createTextNode(i.project_name));c.appendChild(v);r.appendChild(f);var l=document.createElement("td"),e=n.departments.filter(function(n){return n.Value===i.department_id.toString()}),y=e.length>0?e[0].Label:"";l.appendChild(document.createTextNode(y));r.appendChild(l);var a=document.createElement("td"),p=n.funding_sources.filter(function(n){return n.Value===i.funding_id.toString()}),w=e.length>0&&i.funding_id!==-1?p[0].Label:"";return a.appendChild(document.createTextNode(w)),r.appendChild(a),o=document.createElement("td"),o.appendChild(n.Milestone.MilestonesView(i.milestones)),r.appendChild(o),s=document.createElement("td"),s.appendChild(document.createTextNode(i.timeline)),r.appendChild(s),r.appendChild(c),h=document.createElement("td"),h.appendChild(document.createTextNode(Utilities.Format_Date(i.date_last_updated))),r.appendChild(h),r},t.Save=function(){var t,i,r,u,f;Utilities.Toggle_Loading_Button("saveProject",!0);n.selected_project.project_name=Utilities.Get_Value("projectName");n.selected_project.milestones=n.Milestone.ReadMilestones();n.selected_project.department_id=parseInt(Utilities.Get_Value("projectDepartment"));n.selected_project.funding_id=parseInt(Utilities.Get_Value("projectFunding"));n.selected_project.timeline=Utilities.Get_Value("projectTimeline");n.selected_project.comment=Utilities.Get_Value("projectComment");t=document.getElementById("projectComplete");n.selected_project.completed=t.checked;i=document.getElementById("projectCommissionerShare");n.selected_project.commissioner_share=i.checked;r=document.getElementById("projectInfrastructureShare");n.selected_project.infrastructure_share=r.checked;u=n.GetPath();f=n.selected_project.id>-1?"Update":"Add";Utilities.Post_Empty(u+"API/Project/"+f,n.selected_project).then(function(t){console.log("post response",t);t.ok?(console.log("post response good"),n.Project.GetProjects(),n.CloseModals()):console.log("some errors happened with post response");Utilities.Toggle_Loading_Button("saveProject",!1)},function(n){console.log("error getting permits",n);Utilities.Toggle_Loading_Button("saveProject",!1)})},t}();n.Project=t}(ProjectTracking||(ProjectTracking={})),function(n){"use strict";function t(){n.DataValue.GetDepartments();n.DataValue.GetFunding();n.DataValue.GetMyDepartments();n.Project.GetProjects()}function i(){document.getElementById("addProject").classList.add("is-active")}function r(){var n,t,i;if(Utilities.Toggle_Loading_Button("saveProject",!1),n=document.querySelectorAll(".modal"),n.length>0)for(t=0;t<n.length;t++)i=n.item(t),i.classList.remove("is-active")}function u(){var n="/",t=window.location.pathname.toLowerCase().indexOf("/projecttracking");return t==0&&(n="/projecttracking/"),n}function f(){n.Project.BuildProjectTrackingList(n.Project.ApplyFilters(n.projects))}function e(){Utilities.Toggle_Loading_Button("addProjectButton",!1);Utilities.Show("filters")}function o(n){var r=document.getElementById("projectList"),i,t;Utilities.Clear_Element(r);i=document.createElement("tr");t=document.createElement("td");t.colSpan=6;t.appendChild(document.createTextNode(n));i.appendChild(t);r.appendChild(i)}n.selected_project=new n.Project;n.projects=[];n.filtered_projects=[];n.departments=[];n.my_departments=[];n.funding_sources=[];n.number_of_milestones=0;n.Start=t;n.ShowAddProject=i;n.CloseModals=r;n.GetPath=u;n.FilterProjects=f;n.FinishedLoading=e;n.AddProjectResultsMessage=o}(ProjectTracking||(ProjectTracking={}));