var Utilities,google,ProjectTracking;(function(n){var t=function(){function t(n,t,i){i===void 0&&(i=!1);this.Label=n;this.Value=t;this.selected=i}return t.GetDepartments=function(){n.departments=[];var i=n.GetPath();Utilities.Get(i+"API/Project/Departments/All").then(function(i){var r,u,f;for(console.log("all departments",i),n.departments.push(new t("All Departments","")),n.departments.push(new t("My Departments Only","mine",!0)),r=0,u=i;r<u.length;r++)f=u[r],n.departments.push(f);t.BuildDataValueSelect("departmentFilter",n.departments)},function(n){console.log("error getting permits",n)})},t.GetMyDepartments=function(){n.my_departments=[];var i=n.GetPath();Utilities.Get(i+"API/Project/Departments/My").then(function(i){console.log("my departments",i);n.my_departments=i;t.BuildDataValueSelect("projectDepartment",i)},function(n){console.log("error getting permits",n)})},t.BuildDataValueSelect=function(n,t){var e=document.getElementById(n),r,f,u,i;for(Utilities.Clear_Element(e),r=0,f=t;r<f.length;r++)u=f[r],i=document.createElement("option"),i.value=u.Value,i.selected=u.selected,i.appendChild(document.createTextNode(u.Label)),e.add(i,null)},t.GetFunding=function(){n.funding_sources=[];var i=n.GetPath();Utilities.Get(i+"API/Project/Funding").then(function(i){var r,u,f;for(console.log("all funding",i),r=0,u=i;r<u.length;r++)f=u[r],n.funding_sources.push(f);t.BuildDataValueSelect("projectFunding",n.funding_sources)},function(n){console.log("error getting funding",n)})},t}();n.DataValue=t})(ProjectTracking||(ProjectTracking={})),function(n){function t(n){typeof n=="string"&&(n=document.getElementById(n));n.classList.add("hide");n.classList.remove("show");n.classList.remove("show-inline");n.classList.remove("show-flex")}function i(n){typeof n=="string"&&(n=document.getElementById(n));n.classList.add("show");n.classList.remove("hide");n.classList.remove("show-inline");n.classList.remove("show-flex")}function l(n){typeof n=="string"&&(n=document.getElementById(n));n.classList.add("show-inline");n.classList.remove("hide");n.classList.remove("show");n.classList.remove("show-flex")}function a(n){typeof n=="string"&&(n=document.getElementById(n));n.classList.add("show-flex");n.classList.remove("hide");n.classList.remove("show-inline");n.classList.remove("show")}function e(n,u,f){var e,o,s;typeof n=="string"&&(n=document.getElementById(n));u&&(r(n),e=document.createElement("div"),e.classList.add("notification"),e.classList.add("is-danger"),o=document.createElement("button"),o.classList.add("delete"),o.onclick=function(){t(n)},e.appendChild(o),Array.isArray(u)?(s=document.createElement("ul"),u.forEach(function(n){var t=document.createElement("li");t.appendChild(document.createTextNode(n));s.appendChild(t)}),e.appendChild(s)):e.appendChild(document.createTextNode(u)),n.appendChild(e));i(n);(f==undefined||f===!0)&&window.setTimeout(function(){t(n)},1e4)}function r(n){if(n!==null&&n!==undefined)while(n.firstChild)n.removeChild(n.firstChild)}function v(n,t,i){i===void 0&&(i=!1);var r=document.createElement("option");return r.value=n,r.text=t,r.selected=i,r}function o(n){return typeof n=="string"&&(n=document.getElementById(n)),n.value}function y(n,t){typeof n=="string"&&(n=document.getElementById(n));var r=n,i=r.valueAsDate;return r.value.length===0?null:(t&&i.setMinutes(i.getTimezoneOffset()),i)}function p(n,t){typeof n=="string"&&(n=document.getElementById(n));n.value=t}function u(n,t){typeof n=="string"&&(n=document.getElementById(n));r(n);n.appendChild(document.createTextNode(t))}function s(n){var u=n.replace("nav-",""),r=document.querySelectorAll("#menuTabs > li > a"),t,i;if(r.length>0)for(t=0;t<r.length;t++)i=r.item(t),i.id===n?i.parentElement.classList.add("is-active"):i.parentElement.classList.remove("is-active");f("#views > section",u)}function w(n,t,i){h(n,"nav-"+i);f(t,i)}function h(n,t){var u=document.querySelectorAll(n),i,r;if(u.length>0)for(i=0;i<u.length;i++)r=u.item(i),r.id===t?r.classList.add("is-active"):r.classList.remove("is-active")}function f(n,r){var e=document.querySelectorAll(n),u,f;if(e.length>0)for(u=0;u<e.length;u++)f=e.item(u),f.id===r?i(f):t(f)}function b(n){return fetch(n,{method:"GET",headers:{"Content-Type":"application/json"},cache:"no-cache",credentials:"include"}).then(function(n){if(console.log("get response",n),!n.ok)throw new Error(n.statusText);return n.json()})}function k(n,t){return fetch(n,{method:"POST",body:JSON.stringify(t),cache:"no-cache",headers:{"Content-Type":"application/json"},credentials:"include"}).then(function(n){if(console.log("Post Response",n),!n.ok)throw new Error(n.statusText);return n.json()})}function d(n,t){return fetch(n,{method:"POST",body:t!==null?JSON.stringify(t):"",cache:"no-cache",headers:{"Content-Type":"application/json"},credentials:"include"}).then(function(n){return n})}function g(n){return n.toLocaleString("en-US",{style:"currency",currency:"USD"})}function nt(n){return n instanceof Date?n.toLocaleDateString("en-us"):new Date(n).toLocaleDateString("en-US")}function tt(n,t,i){var r,u;return(typeof n=="string"&&(n=document.getElementById(n)),r=n,r.tagName.toLowerCase()==="select"?r.parentElement.classList.remove("is-danger"):r.classList.remove("is-danger"),u=o(r).trim(),u.length==0)?(r.tagName.toLowerCase()==="select"?r.parentElement.classList.add("is-danger"):r.classList.add("is-danger"),e(t,i),r.focus(),r.scrollTo(),""):u}function it(n,t){typeof n=="string"&&(n=document.getElementById(n));var i=n;i.disabled=t;i.classList.toggle("is-loading",t)}function rt(n){var u=document.createElement("li"),t,i,f,o,r,e,s;if(n.selected&&u.classList.add("is-active"),t=document.createElement("a"),t.id=n.id,t.onclick=function(){c(n)},n.icon.length>0){for(i=document.createElement("span"),i.classList.add("icon"),i.classList.add("is-medium"),f=document.createElement("i"),o=n.icon.split(" "),r=0,e=o;r<e.length;r++)s=e[r],f.classList.add(s);i.appendChild(f);t.appendChild(i)}return t.appendChild(document.createTextNode(n.label)),u.appendChild(t),u}function c(n){u("menuTitle",n.title);u("menuSubTitle",n.subTitle);s(n.id);document.getElementById(n.autofocusId).focus()}function ut(t,i){for(var f,e=document.getElementById(t),r=0,u=i;r<u.length;r++)f=u[r],e.appendChild(n.Create_Menu_Element(f))}function ft(){return(navigator.userAgent.indexOf("Opera")||navigator.userAgent.indexOf("OPR"))!=-1?"Opera":navigator.userAgent.indexOf("Chrome")!=-1?"Chrome":navigator.userAgent.indexOf("Safari")!=-1?"Safari":navigator.userAgent.indexOf("Firefox")!=-1?"Firefox":navigator.userAgent.indexOf("MSIE")!=-1||!!document.DOCUMENT_NODE==!0?"IE":"unknown"}n.Hide=t;n.Show=i;n.Show_Inline=l;n.Show_Flex=a;n.Error_Show=e;n.Clear_Element=r;n.Create_Option=v;n.Get_Value=o;n.Get_Date_Value=y;n.Set_Value=p;n.Set_Text=u;n.Show_Menu=s;n.Handle_Tabs=w;n.Activate_Inactivate_Selector=h;n.Show_Hide_Selector=f;n.Get=b;n.Post=k;n.Post_Empty=d;n.Format_Amount=g;n.Format_Date=nt;n.Validate_Text=tt;n.Toggle_Loading_Button=it;n.Create_Menu_Element=rt;n.Update_Menu=c;n.Build_Menu_Elements=ut;n.CheckBrowser=ft}(Utilities||(Utilities={})),function(n){"use strict";var t=function(){function t(){this.id=-1;this.project_id=-1;this.comment="";this.update_only=!1;this.added_by="";this.added_on=new Date;this.by_county_manager=!1}return t.UpdateOnly=function(){var t="updateProjectAsUpToDate",i;(Utilities.Toggle_Loading_Button(t,!0),console.log("current project",n.selected_project),n.selected_project.id!==-1)&&(i=n.GetPath(),Utilities.Post_Empty(i+"API/Project/AddUpdateComment?project_id="+n.selected_project.id.toString(),null).then(function(i){console.log("post response",i);i.ok?(n.Project.GetProjects(),n.CloseModals()):(console.log("some errors happened with post response"),alert("There was an issue saving this update.  Please try again, and put in a help desk ticket if the issue persists."));Utilities.Toggle_Loading_Button(t,!1)},function(n){console.log("error getting permits",n);Utilities.Toggle_Loading_Button(t,!1)}))},t.CommentsView=function(t,i){var r,u,o,f,e,s;if(t.sort(function(n,t){return n.id-t.id}),r=document.createDocumentFragment(),t.length===0)return r;for(u=document.createElement("ol"),u.style.marginLeft="1em",o=function(t){var o=document.createElement("li"),l=i?t.added_by+" - "+t.comment:t.comment,s=document.createElement("span"),h,r,c,f,e;s.appendChild(document.createTextNode(l));t.by_county_manager&&(s.style.color="red",s.style.fontWeight="bold");o.appendChild(s);i&&(h=document.createElement("button"),h.classList.add("delete"),o.appendChild(h),r=document.createElement("div"),r.style.display="none",r.classList.add("notification"),r.classList.add("is-danger"),o.appendChild(r),c=document.createElement("span"),c.appendChild(document.createTextNode("Are you sure you want to delete this comment?")),r.appendChild(c),f=document.createElement("button"),f.appendChild(document.createTextNode("Delete")),f.classList.add("button"),f.style.marginRight="1em",f.style.marginLeft="1em",f.onclick=function(){Utilities.Toggle_Loading_Button(f,!0);Utilities.Toggle_Loading_Button(e,!0);var i=n.GetPath();Utilities.Post_Empty(i+"API/Project/DeleteComment?comment_id="+t.id.toString(),null).then(function(n){console.log("post response",n);n.ok||(console.log("some errors happened with post response"),alert("There was an issue deleting this comment.  Please try again, and put in a help desk ticket if the issue persists."));Utilities.Toggle_Loading_Button(f,!1);Utilities.Toggle_Loading_Button(e,!1);r.style.display="none";o.style.display="none"},function(n){console.log("error getting delete comment",n);Utilities.Toggle_Loading_Button(f,!1);Utilities.Toggle_Loading_Button(e,!1)})},r.appendChild(f),e=document.createElement("button"),e.classList.add("button"),e.appendChild(document.createTextNode("Cancel")),e.onclick=function(){r.style.display="none"},r.appendChild(e),h.onclick=function(){r.style.display="block"});u.appendChild(o)},f=0,e=t;f<e.length;f++)s=e[f],o(s);return r.appendChild(u),r},t.PopulateCommentsFieldset=function(n){var r=document.getElementById("existingCommentsContainer"),i=document.createElement("legend");i.classList.add("label");i.appendChild(document.createTextNode("Comments"));r.appendChild(i);r.appendChild(t.CommentsView(n,!0))},t}();n.Comment=t}(ProjectTracking||(ProjectTracking={})),function(n){"use strict";var t=function(){function t(){this.id=-1;this.project_id=-1;this.name="";this.display_order=-1;this.completed=!1}return t.AddMilestone=function(){var c,nt,b,l,s,tt,k,h,d,it,e,a,i,v,y,rt,r,p,w,g,f;n.number_of_milestones++;var u=n.number_of_milestones.toString(),ft=t.GetContainer(),ut=document.createDocumentFragment(),o=document.createElement("tr");o.id="milestone"+u;c=document.createElement("td");c.style.textAlign="center";c.style.verticalAlign="middle";c.appendChild(document.createTextNode(u));o.appendChild(c);nt=document.createElement("td");b=document.createElement("div");b.classList.add("field");l=document.createElement("div");l.classList.add("control");l.classList.add("is-medium");s=document.createElement("input");s.classList.add("input");s.classList.add("is-medium");s.type="text";s.id="projectMilestone"+u;l.appendChild(s);b.appendChild(l);nt.appendChild(b);tt=document.createElement("td");k=document.createElement("div");k.classList.add("field");h=document.createElement("div");h.classList.add("control");h.classList.add("is-medium");h.classList.add("has-text-centered");d=document.createElement("input");d.type="checkbox";d.id="projectMilestoneCompleted"+u;h.appendChild(d);k.appendChild(h);tt.appendChild(k);o.appendChild(nt);it=document.createElement("td");e=document.createElement("div");e.classList.add("field");e.classList.add("is-grouped");a=document.createElement("div");a.classList.add("control");i=document.createElement("button");i.id="milestoneUp"+u;i.type="button";i.style.borderRadius="99px";i.setAttribute("aria-label","Move Milestone Up");i.classList.add("button");i.classList.add("is-medium");i.disabled=n.number_of_milestones===1;i.onclick=function(){t.MoveUp(u)};v=document.createElement("span");v.classList.add("icon");v.classList.add("is-large");y=document.createElement("i");y.classList.add("fas");y.classList.add("fa-arrow-circle-up");y.classList.add("fa-2x");v.appendChild(y);i.appendChild(v);a.appendChild(i);rt=document.createElement("div");rt.classList.add("control");r=document.createElement("button");r.id="milestoneDown"+u;r.type="button";r.style.borderRadius="99px";r.setAttribute("aria-label","Move Milestone Down");r.classList.add("button");r.classList.add("is-medium");r.disabled=!0;r.onclick=function(){t.MoveDown(u)};p=document.createElement("span");p.classList.add("icon");p.classList.add("is-large");w=document.createElement("i");w.classList.add("fas");w.classList.add("fa-arrow-circle-down");w.classList.add("fa-2x");p.appendChild(w);r.appendChild(p);a.appendChild(r);g=document.createElement("div");g.classList.add("control");f=document.createElement("button");f.id="milestoneRemove"+u;f.classList.add("is-warning");f.classList.add("button");f.classList.add("is-medium");f.disabled=n.number_of_milestones===1;f.appendChild(document.createTextNode("Remove"));f.onclick=function(){t.Remove(u)};g.appendChild(f);e.appendChild(a);e.appendChild(rt);e.appendChild(g);it.appendChild(e);o.appendChild(it);o.appendChild(tt);ut.appendChild(o);ft.appendChild(ut);t.UpdateMilestoneButtons()},t.MoveUp=function(n){var t=parseInt(n);if(t>1){var i="projectMilestone"+n,r="projectMilestone"+(t-1).toString(),u=Utilities.Get_Value(i),f=Utilities.Get_Value(r);Utilities.Set_Value(i,f);Utilities.Set_Value(r,u)}},t.MoveDown=function(t){var i=parseInt(t);if(i<n.number_of_milestones){var r="projectMilestone"+t,u="projectMilestone"+(i+1).toString(),f=Utilities.Get_Value(r),e=Utilities.Get_Value(u);Utilities.Set_Value(r,e);Utilities.Set_Value(u,f)}},t.Remove=function(i){var f=parseInt(i),r,u;if(f<n.number_of_milestones)for(r=f;r<=n.number_of_milestones;r++)t.MoveDown(r.toString());u=document.getElementById("milestone"+n.number_of_milestones.toString());u.parentNode.removeChild(u);n.number_of_milestones--;t.UpdateMilestoneButtons()},t.UpdateMilestoneButtons=function(){for(var i,r,t=1;t<=n.number_of_milestones;t++)i=document.getElementById("milestoneDown"+t.toString()),i.disabled=t===n.number_of_milestones,r=document.getElementById("milestoneRemove"+t.toString()),r.disabled=n.number_of_milestones===1},t.GetContainer=function(){return document.getElementById("projectMilestones")},t.ClearMilestones=function(){n.number_of_milestones=0;Utilities.Clear_Element(t.GetContainer())},t.LoadMilestones=function(n){var i,u,r,e,f;for(t.ClearMilestones(),i=0,u=n;i<u.length;i++)f=u[i],t.AddMilestone();for(r=0,e=n;r<e.length;r++)f=e[r],t.UpdateMilestone(f);t.UpdateMilestoneButtons()},t.UpdateMilestone=function(n){Utilities.Set_Value("projectMilestone"+n.display_order.toString(),n.name);var t=document.getElementById("projectMilestoneCompleted"+n.display_order.toString());t.checked=n.completed},t.MilestonesView=function(n,t){var e,r,u,o,s,h,f,i;if(n.sort(function(n,t){return n.display_order-t.display_order}),e=document.createDocumentFragment(),n.length===0)return e;for(r=document.createElement("ol"),r.classList.add("comments"),u=[],o=0,s=n;o<s.length;o++)h=s[o],f=document.createElement("li"),f.appendChild(document.createTextNode(h.name)),h.completed&&(f.classList.add("hide"),f.classList.add("show-for-print"),u.push(f)),r.appendChild(f);return i=document.createElement("li"),u.length>0&&(i.classList.add("hide-for-print"),t?i.classList.add("completed_milestones_are_hidden_project_completed"):i.classList.add("completed_milestones_are_hidden_project_incomplete"),i.appendChild(document.createTextNode("click to view completed milestones")),r.appendChild(i),r.style.cursor="pointer"),r.onclick=function(){var t,n,r,f;if(u.length!==0){for(t=u[0].classList.contains("hide"),n=0,r=u;n<r.length;n++)f=r[n],t?f.classList.remove("hide"):f.classList.add("hide");t?i.classList.add("hide"):i.classList.remove("hide")}},e.appendChild(r),e},t.ReadMilestones=function(){for(var u,r,f=[],i=50;i>0;i--)u=document.getElementById("projectMilestone"+i.toString()),u!==null&&Utilities.Get_Value(u).trim().length===0&&t.Remove(i.toString());for(i=1;i<=n.number_of_milestones;i++)r=new t,r.display_order=i,r.name=Utilities.Get_Value("projectMilestone"+i.toString()).trim(),r.completed=document.getElementById("projectMilestoneCompleted"+i.toString()).checked,f.push(r);return f},t}();n.Milestone=t}(ProjectTracking||(ProjectTracking={})),function(n){"use strict";var t,i;(function(n){n[n.Low=0]="Low";n[n.Normal=1]="Normal";n[n.High=2]="High"})(t=n.PriorityLevel||(n.PriorityLevel={}));i=function(){function i(){this.id=-1;this.project_name="";this.department_id=-1;this.funding_id=1;this.timeline="";this.commissioner_share=!1;this.infrastructure_share=!1;this.legislative_tracking=!1;this.completed=!1;this.date_last_updated=null;this.date_completed=null;this.can_edit=!1;this.milestones=[];this.comments=[];this.phase_1_name="";this.phase_2_name="";this.phase_3_name="";this.phase_4_name="";this.phase_5_name=""}return i.GetProjects=function(){var t,r;n.charts={};t="filterRefreshButton";Utilities.Toggle_Loading_Button(t,!0);r=n.GetPath();Utilities.Get(r+"API/Project/List").then(function(r){console.log("projects",r);n.projects=r;var u=i.ApplyFilters(r);i.BuildProjectTrackingList(u);i.BuildProjectSummaryList(u);n.FinishedLoading();r.length===0&&n.AddProjectResultsMessage("No projects were found. You can use the Add Project button to add a new project.");Utilities.Toggle_Loading_Button(t,!1)},function(i){i.message.trim().toLowerCase()==="unauthorized"?n.AddProjectResultsMessage("You do not currently have access to the Project Tracking application."):i&&(n.AddProjectResultsMessage("There was a problem retrieving a list of projects.  Please try again. If this issue persists, please put in a help desk ticket."),console.log("error getting permits",i));Utilities.Toggle_Loading_Button(t,!1)})},i.ApplyFilters=function(i){var u=Utilities.Get_Value("departmentFilter"),f=n.project_name_filter.toUpperCase(),r=document.getElementById("projectCommissionerShareFilter").checked,e=document.getElementById("projectCompleteFilter").checked,o=document.getElementById("projectInfrastructureFilter").checked,s=document.getElementById("projectLegislativeFilter").checked,h=document.getElementById("projectHighPriorityFilter").checked,c=document.getElementById("projectNeedsAttentionFilter").checked;return i=i.filter(function(n){return u.length===0||n.department_id.toString()===u||u==="mine"&&n.can_edit}),i=i.filter(function(n){return r&&n.commissioner_share||!r}),i=i.filter(function(n){return r&&n.commissioner_share||!r}),i=i.filter(function(n){return s&&n.legislative_tracking||!s}),i=i.filter(function(n){return e&&!n.completed||!e}),i=i.filter(function(n){return c&&n.needs_attention||!c}),i=i.filter(function(n){return h&&n.priority===t.High||!h}),i=i.filter(function(n){return o&&n.infrastructure_share||!o}),i.filter(function(n){return f.length>0&&n.project_name.toUpperCase().indexOf(f)>-1||f.length===0})},i.AddProject=function(){Utilities.Hide("updateProjectAsUpToDate");n.selected_project=new i;i.UpdateProjectName("");i.UpdateProjectDepartment("");i.UpdateProjectFunding("0");n.Milestone.ClearMilestones();i.UpdateProjectTimeline("");i.UpdateProjectCompleted(!1);i.UpdateNeedsAttention(!1);i.UpdateProjectPriority(1);i.UpdateCommissionerShare(!1);i.UpdateInfrastructureShare(!1);i.UpdateLegislativeTracking(!1);i.UpdateProjectEstimatedCompletionDate("");i.UpdatePhaseDates(null);var t=document.getElementById("existingCommentsContainer");Utilities.Hide(t);Utilities.Clear_Element(t);i.ClearComment();n.ShowAddProject()},i.LoadProject=function(t){Utilities.Show("updateProjectAsUpToDate");t.comments=t.comments.filter(function(n){return n.comment.length>0});i.UpdateProjectName(t.project_name);i.UpdateProjectDepartment(t.department_id.toString());i.UpdateProjectFunding(t.funding_id.toString());n.Milestone.LoadMilestones(t.milestones);i.UpdateProjectTimeline(t.timeline);i.UpdateProjectCompleted(t.completed);i.UpdateCommissionerShare(t.commissioner_share);i.UpdateInfrastructureShare(t.infrastructure_share);i.UpdateLegislativeTracking(t.legislative_tracking);i.UpdateNeedsAttention(t.needs_attention);i.UpdateProjectEstimatedCompletionDate(t.estimated_completion_date);i.UpdatePhaseDates(t);i.UpdateProjectPriority(t.priority);var r=document.getElementById("existingCommentsContainer");Utilities.Clear_Element(r);t.comments.length>0?(Utilities.Show(r),n.Comment.PopulateCommentsFieldset(t.comments)):Utilities.Hide(r);i.ClearComment();n.ShowAddProject()},i.UpdatePhaseDates=function(n){n===null?(Utilities.Set_Value("phase_1_name",""),Utilities.Set_Value("phase_2_name",""),Utilities.Set_Value("phase_3_name",""),Utilities.Set_Value("phase_4_name",""),Utilities.Set_Value("phase_5_name",""),Utilities.Set_Value("phase_1_start",""),Utilities.Set_Value("phase_2_start",""),Utilities.Set_Value("phase_3_start",""),Utilities.Set_Value("phase_4_start",""),Utilities.Set_Value("phase_5_start",""),Utilities.Set_Value("phase_1_completion",""),Utilities.Set_Value("phase_2_completion",""),Utilities.Set_Value("phase_3_completion",""),Utilities.Set_Value("phase_4_completion",""),Utilities.Set_Value("phase_5_completion","")):(Utilities.Set_Value("phase_1_name",n.phase_1_name),Utilities.Set_Value("phase_2_name",n.phase_2_name),Utilities.Set_Value("phase_3_name",n.phase_3_name),Utilities.Set_Value("phase_4_name",n.phase_4_name),Utilities.Set_Value("phase_5_name",n.phase_5_name),i.UpdateDateInput("phase_1_start",n.phase_1_start),i.UpdateDateInput("phase_2_start",n.phase_2_start),i.UpdateDateInput("phase_3_start",n.phase_3_start),i.UpdateDateInput("phase_4_start",n.phase_4_start),i.UpdateDateInput("phase_5_start",n.phase_5_start),i.UpdateDateInput("phase_1_completion",n.phase_1_completion),i.UpdateDateInput("phase_2_completion",n.phase_2_completion),i.UpdateDateInput("phase_3_completion",n.phase_3_completion),i.UpdateDateInput("phase_4_completion",n.phase_4_completion),i.UpdateDateInput("phase_5_completion",n.phase_5_completion))},i.UpdateDateInput=function(n,t){var r=document.getElementById(n),i;(r.value="",t!==null)&&(i=t.toString(),new Date(i).getFullYear()>1e3&&(r.valueAsDate=new Date(i)))},i.UpdateProjectName=function(n){Utilities.Set_Value("projectName",n)},i.UpdateProjectDepartment=function(n){Utilities.Set_Value("projectDepartment",n)},i.UpdateProjectPriority=function(n){Utilities.Set_Value("projectPriority",n.toString())},i.UpdateProjectEstimatedCompletionDate=function(n){var t=document.getElementById("projectEstimatedCompletionDate");t.value="";new Date(n.toString()).getFullYear()>1e3&&(t.valueAsDate=new Date(n))},i.UpdateProjectFunding=function(n){Utilities.Set_Value("projectFunding",n)},i.UpdateProjectTimeline=function(n){Utilities.Set_Value("projectTimeline",n)},i.UpdateProjectCompleted=function(n){var t=document.getElementById("projectComplete");t.checked=n},i.UpdateInfrastructureShare=function(n){var t=document.getElementById("projectInfrastructureShare");t.checked=n},i.UpdateLegislativeTracking=function(n){var t=document.getElementById("projectLegislativeTracking");t.checked=n},i.UpdateCommissionerShare=function(n){var t=document.getElementById("projectCommissionerShare");t.checked=n},i.UpdateNeedsAttention=function(n){var t=document.getElementById("projectNeedsAttention");t.checked=n},i.ClearComment=function(){Utilities.Set_Value("projectComment","")},i.BuildProjectTrackingList=function(n){var f=document.getElementById("projectList"),r,t,u,e;for(Utilities.Clear_Element(f),r=document.createDocumentFragment(),t=0,u=n;t<u.length;t++)e=u[t],r.appendChild(i.CreateProjectRow(e));f.appendChild(r)},i.BuildProjectSummaryList=function(n){var c=document.getElementById("projectSummary"),t,r,s,u,h,f,e,o;for(Utilities.Clear_Element(c),t=document.createDocumentFragment(),r=0,s=n;r<s.length;r++)u=s[r],h=i.CreateGanttChartRows(u),t.appendChild(i.CreateProjectSummaryRow(u,h)),h.length>0&&(f=document.createElement("tr"),f.classList.add("hide"),e=document.createElement("td"),e.colSpan=5,o=document.createElement("div"),o.id="chart_"+u.id.toString(),o.style.width="100%",e.appendChild(o),f.appendChild(e),t.appendChild(f));c.appendChild(t)},i.CreateProjectSummaryRow=function(t,r){var u=document.createElement("tr"),s,f,e,c,o;u.classList.add("pagebreak");s=document.createElement("td");f=document.createElement("div");s.appendChild(f);t.can_edit?(e=document.createElement("a"),e.appendChild(document.createTextNode(t.project_name)),e.onclick=function(){n.selected_project=t;i.LoadProject(t);console.log("selected_project",n.selected_project)},f.appendChild(e)):f.appendChild(document.createTextNode(t.project_name));u.appendChild(s);var l=document.createElement("td"),h=n.departments.filter(function(n){return n.Value===t.department_id.toString()}),v=h.length>0?h[0].Label:"";l.appendChild(document.createTextNode(v));u.appendChild(l);var a=document.createElement("td"),y=n.funding_sources.filter(function(n){return n.Value===t.funding_id.toString()}),p=h.length>0&&t.funding_id!==-1?y[0].Label:"";return a.appendChild(document.createTextNode(p)),u.appendChild(a),u.appendChild(i.GetCurrentPhase(t,!0,r)),c=document.createElement("td"),o=document.createElement("div"),o.classList.add("has-text-centered"),c.appendChild(o),new Date(t.estimated_completion_date.toString()).getFullYear()>1e3&&o.appendChild(document.createTextNode(Utilities.Format_Date(t.estimated_completion_date))),u.appendChild(c),u},i.CreateProjectRow=function(r){var u,h,f,c,y,o,e,a,v,s;r.comments=r.comments.filter(function(n){return n.comment.length>0});u=document.createElement("tr");r.needs_attention?u.classList.add("needs-attention"):r.completed&&u.classList.add("completed");u.classList.add("pagebreak");h=document.createElement("td");f=document.createElement("div");h.appendChild(f);c=document.createElement("td");y=n.Comment.CommentsView(r.comments,!1);r.can_edit?(o=document.createElement("a"),o.appendChild(document.createTextNode(r.project_name)),o.onclick=function(){n.selected_project=r;i.LoadProject(r);console.log("selected_project",n.selected_project)},f.appendChild(o)):f.appendChild(document.createTextNode(r.project_name));r.priority!==t.Normal&&(e=document.createElement("p"),e.appendChild(document.createTextNode(t[r.priority].toString()+" priority")),f.appendChild(e));r.needs_attention&&(e=document.createElement("p"),e.appendChild(document.createTextNode("Needs Attention")),f.appendChild(e));c.appendChild(y);u.appendChild(h);var p=document.createElement("td"),l=n.departments.filter(function(n){return n.Value===r.department_id.toString()}),b=l.length>0?l[0].Label:"";p.appendChild(document.createTextNode(b));u.appendChild(p);var w=document.createElement("td"),k=n.funding_sources.filter(function(n){return n.Value===r.funding_id.toString()}),d=l.length>0&&r.funding_id!==-1?k[0].Label:"";return w.appendChild(document.createTextNode(d)),u.appendChild(w),a=document.createElement("td"),a.appendChild(n.Milestone.MilestonesView(r.milestones,r.completed)),u.appendChild(a),u.appendChild(i.GetCurrentPhase(r,!1,[])),u.appendChild(c),v=document.createElement("td"),s=document.createElement("div"),s.classList.add("has-text-centered"),v.appendChild(s),s.appendChild(document.createTextNode(Utilities.Format_Date(r.date_last_updated))),u.appendChild(v),u},i.GetCurrentPhase=function(n,t,r){var v="Ignore this Phase",e=document.createElement("td"),f=document.createElement("span"),h="",b=!1,u,c,g,p,nt,l,o;if(n.completed)return t&&(o=document.createElement("img"),o.src="content/images/circle-green128.png",e.appendChild(o)),f.appendChild(document.createTextNode("Project Completed")),e.appendChild(f),e;var y=0,k=null,s=null;for(u=1;u<6;u++){var a=n["phase_"+u.toString()+"_name"],it=n["phase_"+u.toString()+"_start"],d=n["phase_"+u.toString()+"_completion"];if(d!==null&&(b=!0),d===null&&a!==v&&a.length>0){if(it!==null&&a!==v&&a.length>0){for(y=u,k=n["phase_"+u.toString()+"_start"],c=u+1;c<6;c++)if(g=n["phase_"+c.toString()+"_name"],p=n["phase_"+c.toString()+"_start"],g!==v&&p!==null){s=p;break}s===null&&(s=n.estimated_completion_date)}break}}if(y===0)b?(f.appendChild(document.createTextNode("Phases Completed, Project not marked as completed.")),h="green"):(f.appendChild(document.createTextNode("Phases not entered.")),h="black");else{if(nt=i.GetPhaseName(y,n),l=nt+":  "+Utilities.Format_Date(k),l+=" - ",s===null)l+="No Ending Date";else{l+=Utilities.Format_Date(s);var w=new Date,rt=new Date(w.getFullYear(),w.getMonth(),w.getDate()),tt=Math.round((rt.getTime()-new Date(s).getTime())/864e5);h=tt>30?"red":tt>0?"yellow":"green"}f.appendChild(document.createTextNode(l))}return t&&h.length>0&&(o=document.createElement("img"),o.src="content/images/circle-"+h+"128.png",e.appendChild(o)),e.appendChild(f),r.length>0&&(f.onclick=function(){i.DrawGanttChart(n.id,r)},f.style.cursor="pointer"),e},i.GetPhaseName=function(n,t){return n===6?"Completed":t["phase_"+n.toString()+"_name"]},i.ValidatePhaseDate=function(n,t){var i,r;return n["phase_"+t.toString()+"_name"]==="Ignore this Phase"?!0:(i=n["phase_"+t+"_start"],r=n["phase_"+t+"_completion"],i!==null&&r!==null)?i<=r:!0},i.ValidatePhaseDates=function(){var r="",f,u,e,o,t,s;for(n.selected_project.estimated_completion_date=Utilities.Get_Date_Value("projectEstimatedCompletionDate",!0),n.selected_project.phase_1_name=Utilities.Get_Value("phase_1_name"),n.selected_project.phase_2_name=Utilities.Get_Value("phase_2_name"),n.selected_project.phase_3_name=Utilities.Get_Value("phase_3_name"),n.selected_project.phase_4_name=Utilities.Get_Value("phase_4_name"),n.selected_project.phase_5_name=Utilities.Get_Value("phase_5_name"),n.selected_project.phase_1_start=Utilities.Get_Date_Value("phase_1_start",!0),n.selected_project.phase_2_start=Utilities.Get_Date_Value("phase_2_start",!0),n.selected_project.phase_3_start=Utilities.Get_Date_Value("phase_3_start",!0),n.selected_project.phase_4_start=Utilities.Get_Date_Value("phase_4_start",!0),n.selected_project.phase_5_start=Utilities.Get_Date_Value("phase_5_start",!0),n.selected_project.phase_1_completion=Utilities.Get_Date_Value("phase_1_completion",!0),n.selected_project.phase_2_completion=Utilities.Get_Date_Value("phase_2_completion",!0),n.selected_project.phase_3_completion=Utilities.Get_Date_Value("phase_3_completion",!0),n.selected_project.phase_4_completion=Utilities.Get_Date_Value("phase_4_completion",!0),n.selected_project.phase_5_completion=Utilities.Get_Date_Value("phase_5_completion",!0),f=n.selected_project,u=[],t=1;t<6;t++){if(e=f["phase_"+t.toString()+"_start"],o=f["phase_"+t.toString()+"_name"],o!=="Ignore this Phase"&&o.length>0&&e===null){r="You have selected a phase name but not put in a start date.";break}e!==null&&u.push(e);i.ValidatePhaseDate(f,t)||(r="Actual Completion Dates must be no earlier than the same date as the Start Date.")}if(u.length>0&&r.length===0)if(f.estimated_completion_date===null)r="The Estimated Project Completion date is required if the phase dates are utilized.";else for(t=0;t<u.length;t++)if(t+1<u.length&&(u[t]>u[t+1]||u[t]>f.estimated_completion_date)){r="Phase dates must be in order.  An earlier phase cannot have a start date greater than a later phase or the project's estimated completion date.";break}return Utilities.Set_Text("phase_dates_error",r),r.length>0&&(s=document.getElementById("phase_dates_error"),s.scrollTo()),r.length===0},i.Save=function(){var r,u,f,e,o,s,h,c,l,a;if(Utilities.Toggle_Loading_Button("saveProject",!0),r=Utilities.Get_Value("projectName").trim(),r.length===0){u=document.getElementById("projectName");f=document.getElementById("projectNameEmpty");Utilities.Error_Show(f,"",!0);u.focus();u.scrollTo();Utilities.Toggle_Loading_Button("saveProject",!1);return}if(!i.ValidatePhaseDates()){Utilities.Toggle_Loading_Button("saveProject",!1);return}n.selected_project.project_name=r;n.selected_project.milestones=n.Milestone.ReadMilestones();n.selected_project.department_id=parseInt(Utilities.Get_Value("projectDepartment"));n.selected_project.funding_id=parseInt(Utilities.Get_Value("projectFunding"));n.selected_project.timeline=Utilities.Get_Value("projectTimeline");n.selected_project.comment=Utilities.Get_Value("projectComment");n.selected_project.priority=t[Utilities.Get_Value("projectPriority")];n.selected_project.estimated_completion_date=Utilities.Get_Value("projectEstimatedCompletionDate");n.selected_project.phase_1_name=Utilities.Get_Value("phase_1_name");n.selected_project.phase_2_name=Utilities.Get_Value("phase_2_name");n.selected_project.phase_3_name=Utilities.Get_Value("phase_3_name");n.selected_project.phase_4_name=Utilities.Get_Value("phase_4_name");n.selected_project.phase_5_name=Utilities.Get_Value("phase_5_name");n.selected_project.phase_1_start=Utilities.Get_Date_Value("phase_1_start",!0);n.selected_project.phase_2_start=Utilities.Get_Date_Value("phase_2_start",!0);n.selected_project.phase_3_start=Utilities.Get_Date_Value("phase_3_start",!0);n.selected_project.phase_4_start=Utilities.Get_Date_Value("phase_4_start",!0);n.selected_project.phase_5_start=Utilities.Get_Date_Value("phase_5_start",!0);n.selected_project.phase_1_completion=Utilities.Get_Date_Value("phase_1_completion",!0);n.selected_project.phase_2_completion=Utilities.Get_Date_Value("phase_2_completion",!0);n.selected_project.phase_3_completion=Utilities.Get_Date_Value("phase_3_completion",!0);n.selected_project.phase_4_completion=Utilities.Get_Date_Value("phase_4_completion",!0);n.selected_project.phase_5_completion=Utilities.Get_Date_Value("phase_5_completion",!0);e=document.getElementById("projectComplete");n.selected_project.completed=e.checked;o=document.getElementById("projectCommissionerShare");n.selected_project.commissioner_share=o.checked;s=document.getElementById("projectInfrastructureShare");n.selected_project.infrastructure_share=s.checked;h=document.getElementById("projectLegislativeTracking");n.selected_project.legislative_tracking=h.checked;c=document.getElementById("projectNeedsAttention");n.selected_project.needs_attention=c.checked;console.log("project to save",n.selected_project);l=n.GetPath();a=n.selected_project.id>-1?"Update":"Add";Utilities.Post_Empty(l+"API/Project/"+a,n.selected_project).then(function(t){console.log("post response",t);t.ok?(console.log("post response good"),n.Project.GetProjects(),n.CloseModals()):console.log("some errors happened with post response");Utilities.Toggle_Loading_Button("saveProject",!1)},function(n){console.log("error getting permits",n);Utilities.Toggle_Loading_Button("saveProject",!1)})},i.PopulatePriorities=function(){var r=document.getElementById("projectPriority"),n,i;Utilities.Clear_Element(r);console.log("prioritylevel",t);for(n in t)n.length<3&&(i=document.createElement("option"),i.value=n.toString(),i.appendChild(document.createTextNode(t[n].toString())),n===t.Normal.toString()&&(i.selected=!0),r.appendChild(i))},i.ToggleSummaryView=function(){var t=document.getElementById("toggleSummaryView"),i;Utilities.Toggle_Loading_Button(t,!0);i=document.createElement("strong");Utilities.Clear_Element(t);n.default_view?(Utilities.Set_Text(i,"Switch to Default View"),Utilities.Hide("projectDefaultView"),Utilities.Show("projectSummaryView")):(Utilities.Set_Text(i,"Switch to Summary View"),Utilities.Show("projectDefaultView"),Utilities.Hide("projectSummaryView"));t.appendChild(i);n.default_view=!n.default_view;Utilities.Toggle_Loading_Button(t,!1)},i.CreateGanttChartRows=function(n){var i,u,t,o,f,s,r;if(n.completed)return[];for(i=[],t=1;t<6;t++){var e=n["phase_"+t.toString()+"_name"],c=n["phase_"+t.toString()+"_start"],h=n["phase_"+t.toString()+"_completion"];e.length>0&&e!=="Ignore this Phase"&&i.push({name:e,start:new Date(c),end:h===null?null:new Date(h)})}if(u=new Date(n.estimated_completion_date),u.getFullYear()<1e3&&(u=null),i.length===0)return i;for(t=0;t<i.length;t++)r=i[t],r.end===null&&(r.end=t===i.length-1?u:i[t+1].start);for(o=[],f=0,s=i;f<s.length;f++)r=s[f],o.push([r.name,r.name,null,r.start,r.end,null,100,null]);return o},i.DrawGanttChart=function(t,i){var u=document.getElementById("chart_"+t.toString()),f=!1,e,r,o;(n.charts[t]===undefined&&(n.charts[t]=new google.visualization.Gantt(u),f=!0),e=u.parentElement.parentElement,e.classList.toggle("hide"),i.length!==0&&f)&&(r=new google.visualization.DataTable,r.addColumn("string","Task ID"),r.addColumn("string","Task Name"),r.addColumn("string","Resource"),r.addColumn("date","Start Date"),r.addColumn("date","End Date"),r.addColumn("number","Duration"),r.addColumn("number","Percent Complete"),r.addColumn("string","Dependencies"),r.addRows(i),o={height:i.length*50+50,gantt:{percentEnabled:!1,criticalPathEnabled:!1,labelStyle:{fontName:"Segoe UI",fontSize:16,color:"#363636"}}},n.charts[t].draw(r,o))},i}();n.Project=i}(ProjectTracking||(ProjectTracking={})),function(n){"use strict";function t(){h();n.DataValue.GetDepartments();n.DataValue.GetFunding();n.DataValue.GetMyDepartments();n.Project.GetProjects();n.Project.PopulatePriorities()}function i(){document.getElementById("addProject").classList.add("is-active")}function r(){var n,t,i;if(Utilities.Toggle_Loading_Button("saveProject",!1),n=document.querySelectorAll(".modal"),n.length>0)for(t=0;t<n.length;t++)i=n.item(t),i.classList.remove("is-active")}function u(){var n="/",t=window.location.pathname.toLowerCase().indexOf("/projecttracking");return t==0&&(n="/projecttracking/"),n}function f(){var t=n.Project.ApplyFilters(n.projects);n.Project.BuildProjectTrackingList(t);n.Project.BuildProjectSummaryList(t)}function e(t){var r=t.value.trim(),i;n.project_name_filter=r.length>2?r:"";i=n.Project.ApplyFilters(n.projects);n.Project.BuildProjectTrackingList(i);n.Project.BuildProjectSummaryList(i)}function o(){Utilities.Toggle_Loading_Button("addProjectButton",!1);Utilities.Toggle_Loading_Button("toggleSummaryView",!1);Utilities.Show("filters")}function s(n){var r=document.getElementById("projectList"),i,t;Utilities.Clear_Element(r);i=document.createElement("tr");t=document.createElement("td");t.colSpan=6;t.appendChild(document.createTextNode(n));i.appendChild(t);r.appendChild(i)}function h(){for(var i,n,r,u,f=["Develop Specifications","Procurement","Design","Bid","Implementation","Construction","Ignore this Phase",],t=1;t<6;t++)for(i=document.getElementById("phase_"+t.toString()+"_name"),i.add(Utilities.Create_Option("","Select Phase Name",!0)),n=0,r=f;n<r.length;n++)u=r[n],i.add(Utilities.Create_Option(u,u,!1))}n.charts={};n.selected_project=new n.Project;n.projects=[];n.filtered_projects=[];n.departments=[];n.my_departments=[];n.funding_sources=[];n.number_of_milestones=0;n.project_name_filter="";n.default_view=!0;n.Start=t;n.ShowAddProject=i;n.CloseModals=r;n.GetPath=u;n.FilterProjects=f;n.FilterProjectNames=e;n.FinishedLoading=o;n.AddProjectResultsMessage=s}(ProjectTracking||(ProjectTracking={}));